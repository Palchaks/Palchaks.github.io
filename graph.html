<!DOCTYPE html>
<html>
<head>
    <title>Graph with Edge Labels Above and Below</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 100vh;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
<input type="file" id="fileInput" accept=".csv">
<div id="mynetwork"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
document.getElementById('fileInput').addEventListener('change', function(event) {
    var file = event.target.files[0];
    Papa.parse(file, {
        complete: function(results) {
            var data = results.data;
            var nodesArray = [];
            var edgesArray = [];
            var nodeIds = new Set();

            function getGenericLabel(nodeName) {
                if (nodeName.includes('Variance')) return 'Variance';
                if (nodeName.includes('Growth')) return 'Growth';
                return nodeName; // Return original name if no changes needed
            }

            for (var i = 1; i < data.length; i++) { // Start from 1 to skip header row
                var row = data[i];

                var sourceLabel = getGenericLabel(row[0]);
                if (!nodeIds.has(row[0])) {
                    nodesArray.push({
                        id: row[0],
                        label: sourceLabel,
                        color: {
                            background: row[1] === 'Metric' ? '#fff2f8' : '#4e136c',
                            border: '#2B7CE9',
                            highlight: {
                                background: '#6633ff',
                                border: '#2B7CE9',
                                color: '#000000'
                            }
                        },
                        font: {
                            color: row[1] === 'Metric' ? 'black' : 'white'
                        },
                        shape: 'box'
                    });
                    nodeIds.add(row[0]);
                }

                var destinationLabel = getGenericLabel(row[2]);
                if (!nodeIds.has(row[2])) {
                    nodesArray.push({
                        id: row[2],
                        label: destinationLabel,
                        color: {
                            background: row[3] === 'Metric' ? '#fff2f8' : '#4e136c',
                            border: '#2B7CE9',
                            highlight: {
                                background: '#6633ff',
                                border: '#2B7CE9',
                                color: '#000000'
                            }
                        },
                        font: {
                            color: row[3] === 'Metric' ? 'black' : 'white'
                        },
                        shape: 'box'
                    });
                    nodeIds.add(row[2]);
                }

                // Add Edge with simplified color logic
                var edgeColor = '#848484'; // Default edge color
                if (row[4] === 'DIMENSION') edgeColor = 'green';
                else if (row[4] === 'FUNDAMENTAL') edgeColor = 'blue';

                edgesArray.push({
                    from: row[0],
                    to: row[2],
                    label: row[4],
                    font: {align: 'top'},
                    color: edgeColor,
                    arrows: 'to'
                });
            }

            // Create a network
            var container = document.getElementById('mynetwork');
            var data = {
                nodes: new vis.DataSet(nodesArray),
                edges: new vis.DataSet(edgesArray)
            };
            var options = {
                edges: {
                    width: 3,
                    smooth: {
                        type: 'continuous'
                    }
                },
                layout: {
                    improvedLayout: true
                },
                physics: {
                    enabled: false
                }
            };
            var network = new vis.Network(container, data, options);
        }
    });
});
</script>





</body>
</html>
